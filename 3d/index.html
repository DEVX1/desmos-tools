<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge">
		<title>Desmos 3D</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
		
		<!--Fonts-->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa|Text+Me+One">
		<!--
		<link rel="stylesheet" href="../assets/css/fonts.css">
		-->
		
		<!--jQuery local
		<script src="../assets/js/jquery-3.1.1.min.js"></script>
		-->
		
		<!--jQuery CDN-->
		<script src="https://cdn.jsdelivr.net/jquery/3.2.1/jquery.min.js"></script>
		
		<!--tether JS CDN-->
		<script src="https://cdn.bootcss.com/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
		
		<!--Bootstrap CSS CDN-->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/bootstrap/3.3.7/css/bootstrap.min.css">
		<!--Bootstrap JS CDN-->
		<script src="https://cdn.jsdelivr.net/bootstrap/3.3.7/js/bootstrap.min.js"></script>

		<link rel="stylesheet" href="../assets/css/main.css">
		<link rel="stylesheet" href="./stylesheet.css">
	</head>
	<body scroll="no">
		<header>
			<div class="title-container">
				<span class="logo">desmos</span>
				<span class="title">3D</span>
			</div>
		</header>
		
		<div id="calculator"></div>
		
		<iframe id="ini-state-box" src="./inistate.json"></iframe>
		
		<!--desmos API-->
		<script src="https://www.desmos.com/api/v0.8/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>
		
		<!--desmos API local
		<script defer src="../assets/js/calculator.js"></script>
		-->
		
		<script>
			var state;
			var stateString;
			var explist;
			var isLoaded = false;
			
			var elt = document.getElementById('calculator');
			var calculator = Desmos.GraphingCalculator(elt, {border: false});
			
			var uMin,uMax,vMin,vMax;
			
			function update(){
				state = calculator.getState();
				explist = state.expressions.list;
				
				uMin = explist[15].latex;
				uMax = explist[16].latex;
				vMin = explist[20].latex;
				vMax = explist[21].latex;
				
				calculator.setExpression({
					id: 'border.u', domain: {min: uMin, max: uMax}
				});
				calculator.setExpression({
					id: 'border.v', domain: {min: vMin, max: vMax}
				});
			}
			
			var iframe = document.getElementById('ini-state-box').contentWindow;
			
			function loadini(){
				stateString = iframe.document.body.innerText;
				state = JSON.parse(stateString);
				calculator.setDefaultState(state);
				calculator.setState(state);
			}
			
			iframe.onload = function(){
				if(!isLoaded){
					loadini();
					isLoaded = true;
				}
			};
			
			window.onload = function(){
				if(!isLoaded){
					loadini();
					isLoaded = true;
				}
			};
			
			calculator.observeEvent('change', function (){
				if(isLoaded){
					update();
				}
			});
		</script>
	</body>
</html>